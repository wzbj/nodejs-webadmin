<!-- 分页插件 -->
<link href="/public/css/common/pager.css" rel="stylesheet">
<link href="/public/css/common/mytools.css" rel="stylesheet">
<style>
    .shieldlog .md-radio{
        display: block!important;
    }
    .pageTest{ width: 400px; height: 50px;margin: 0 auto; margin-top: 40px;display:block;}
    .activP{
        background-color: #337ab7!important;
        color: #fff!important;
    }
</style>
<div class="breadcrumbs">
    <h1><i class="icon-users" style="padding-right: 10px;"></i>管理员列表</h1>
    <ol class="breadcrumb">
        <li>管理员管理</li>
        <li class="active">管理员列表</li>
    </ol>
</div>

<div class="page-content-row">
    <!-- END PAGE SIDEBAR -->
    <div class="page-content-col" style="padding-left:0;">
        <!-- BEGIN PAGE BASE CONTENT -->
        <div class="row">
            <div class="col-md-12">
                <!-- BEGIN EXAMPLE TABLE PORTLET-->
                <div class="portlet light bordered bordereds">
                    <div class="portlet-title">
                        <div class="caption" style="color: #36C6D3">
                        <i class="icon-notebook" style="color: #36C6D3"></i>详细信息</div>
                        <div class="tools"> 
                           <button class="btn btn-success" id="addAdmin">添加账号</button>
                        </div>
                    </div>
                    
                    <div class="portlet-body">
                            
                        <table class="table table-striped table-bordered table-hover dt-responsive" width="100%" id="sample_3" cellspacing="0" width="100%">
                            <thead>
                                <tr>
                                    <th class="all duan20">用户ID</th>
                                    <th class="all duan20">昵称</th> 
                                    <th class="all duan20">微信ID</th>
                                    <th class="all duan20">手机号</th>
                                    <th class="all duan20">操作</th>
                                </tr>
                            </thead>
                            <tbody id="tabledata">
                               <tr id="loading">
                                    <td colspan="16"><img style="width: 36px" src="/public/img/common/loading.gif" alt=""></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <!-- <div class="pageTest"></div> -->
                    <div>
                        <ul class="pagination" id="page1">
                        </ul>
                        <div class="pageJump">
                            <span>跳转到</span>
                            <input type="text"/ style="width: 50px!important;">
                            <span>页</span>
                            <button type="button" class="button">确定</button>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-lg-12 col-md-12" style="text-align: right;">
                            <button type="button" id="refresh" class="btn btn-success add refresh">刷新</button>
                        </div>
                    </div>
                </div>
                <!-- END EXAMPLE TABLE PORTLET-->
            </div>
          
        </div>
        <!-- END PAGE BASE CONTENT -->
    </div>
</div>
<!-- 添加账号弹窗 -->
<div class="smdialog addlog" style="display: none;">
    <div class="portlet-body form smdialogcontent lgdialogcontentform">
        <div class="modal-header modal-headers">
            <div class="dialogclose dialogcloses">
                <img src="/public/img/common/remove-icon-small.png"/>
            </div>
            <h4 class="modal-title font-green"><i class=" icon-volume-2" style="padding-right: 10px;"></i>添加后台账号</h4>
        </div>
        <div class="modal-body">
        <!--内容开始-->
            <div class="portlet-body form">
                <!-- BEGIN FORM-->
                <form action="#" class="form-horizontal ">
                     <div class="form-body">
                        <div class="form-group" id="userId" style="display: none;">
                            <label class="control-label col-lg-4 col-md-4 col-sm-4 col-xs-4">用户id:</label>
                            <div class="col-lg-7 col-md-7 col-sm-7 col-xs-7">
                                <input name="personName" value="" class="form-control userId"  readonly="true" type="text"/>
                                <!-- <textarea class="form-control toUserRemark" name="" rows="3" cols="" placeholder=""></textarea> -->
                                <span class="help-block" style="color:red"> </span>
                            </div>
                        </div>
                        <!-- <div class="form-group">
                            <label class="control-label col-lg-4 col-md-4 col-sm-4 col-xs-4">手机号</label>
                            <div class="col-lg-7 col-md-7 col-sm-7 col-xs-7">
                                <input name="personName" value="" class="form-control mobile" type="text"/>
                                <span class="help-block mobileMsg" style="color:red"></span>
                            </div>
                        </div> -->
                        <div class="form-group">
                            <label class="control-label col-lg-4 col-md-4 col-sm-4 col-xs-4">昵称</label>
                            <div class="col-lg-7 col-md-7 col-sm-7 col-xs-7">
                                <input name="personName" value="" class="form-control nickName" type="text"/>
                                <!-- <textarea class="form-control toUserMsg" name="" rows="3" cols=""></textarea> -->
                                <span class="help-block nickNameMsg" style="color:red"> </span>
                            </div>
                        </div>
                         <div class="form-group">
                            <label class="control-label col-lg-4 col-md-4 col-sm-4 col-xs-4">unionId</label>
                            <div class="col-lg-7 col-md-7 col-sm-7 col-xs-7">
                                <input name="personName" value="" class="form-control unionId" type="text"/>
                                <!-- <textarea class="form-control toUserMsg" name="" rows="3" cols=""></textarea> -->
                                <span class="help-block tipsMsg" style="color:red;line-height: 16px;"> </span>
                            </div>
                        </div>
                        <div class="form-group">
                            <!--<label class="control-label col-lg-7 col-md-7 col-sm-7 col-xs-7">真实用户带入机器人配比:</label>-->
                            <label class="control-label col-lg-4 col-md-4 col-sm-4 col-xs-4"></label>
                            <div class="col-lg-7 col-md-7 col-sm-7 col-xs-7" style="text-align: center;">
                                <button id="adminBtn" type="button" class="btn green">
                                    <i class="fa fa-check"></i> 确定</button>
                                <button type="button" id="lgdialogcloses" class="btn default lgdialogcloses">
                                    <i class="fa fa-times"></i>取消</button>
                            </div>
                        </div>
                    </div>
                </form>
                <!-- END FORM-->
            </div>
        <!--内容结束-->
        </div>
     </div>
</div>

<!--信息提示弹窗-->
<div class="smdialog numCgdialog" style="display: none;">
    <div class="portlet-body form smdialogcontent">
        <div class="modal-header modal-headers">
            <h4 class="modal-title font-green"><i class=" icon-volume-2" style="padding-right: 10px;"></i>信息提示</h4>
        </div>
        <div class="modal-body">
        <!--内容开始-->
            <div class="smcontent">
                <p style="color: red;">讽德诵功</p>
            </div>
        <!--内容结束-->
        </div>
     </div>
</div>
        <script src="/public/js/common/mytools.js" type="text/javascript"></script>
        <!-- 分页插件 -->
        <script src="/public/js/common/pager.js" type="text/javascript"></script>
        <script>
            // $('.navbar-nav li.dropdown-fw').eq(12).addClass("open selected").siblings().removeClass("open selected");
            $('.navbar-nav li.dropdown-fw').eq(10).addClass("open selected").siblings().removeClass("open selected");
            $('.dropdown13 ul.dropdown-menu-fw>li').eq(0).addClass("active").siblings().removeClass("active");
            var allPage = null;
            var currentAjax;
            var mobile = '';
            var page =1;
            var loading = '<tr id="loading"><td colspan="5"><img style="width: 36px" src="/public/img/common/loading.gif" alt=""></td></tr>';
            adminList(page);
            // $('.pageTest').page({
            //   leng: pages,//分页总数
            //   activeClass: 'activP' , //active 类样式定义
            //   clickBack:function(page){
            //     window.scrollTo(0,0);
            //     adminList(page);
            //   }
            // })
            // 用户管理账号列表
            function adminList(pageNum){
                var str = '';
                $('#loading').ajaxStart(function(){
                    $(this).show();
                }),
                $.ajax({
                    url:'/New/AdminAccount/mylist',
                    type:"POST",
                    dataType:"json",
                    async: true,
                    data:{
                        pageNum:pageNum,
                        pageSize:50
                    },
                    success:function(data){
                        if(data.code == '200'){
                            var dataD = data.data;
                            allPage = Math.ceil(dataD.total_num/50);
                            var result = dataD.result;
                            var len = result.length;
                            if(len<1){
                                $(".pageTest").css('display','none');
                                $("#tabledata").html("<tr><td class='text-center' colspan='4'>暂时没有数据</td></tr>");
                            }else{
                                for(var i=0;i<len;i++){
                                    str += '<tr><td>'+result[i].adminId+'</td>';
                                    str += '<td>'+result[i].username+'</td>';
                                    str += '<td>'+result[i].unionid+'</td>';
                                    str += '<td>'+result[i].mobile+'</td>';
                                    str +='<td><a href="/New/AdminAccount/bingWX?adminId='+result[i].adminId+'" target="_blank"><button type="button" class="btn btn-success binding" value="">绑定</button></a>';
                                    str +='<button class="btn btn-warning edit">编辑</button>';
                                    if(result[i].status == '0'){
                                        str +='<button class="btn btn-danger cancel">注销</button>';
                                    }
                                    str +='</td></tr>';
                                }
                                
                                
                            }
                            // $('#tabledata').append(str);
                            $('#loading').hide();
                            $('#tabledata').empty();
                            $('#tabledata').html(str);
                            Page({
                                num:allPage,                    //页码数
                                startnum:page,              //指定页码
                                elem:$('#page1'),       //指定的元素
                                callback:function(n){   //回调函数
                                    page = n;
                                    window.scrollTo(0,0);
                                    $('#tbody').html(loading);
                                    // $('#currentPage').html(page);
                                    adminList(page);
                                }
                            });
                            loadFn();
                        }else{
                            // confirm("网络异常");
                        }           
                    }
                })
               
            }
            // 用户编辑接口
            function adminEdit(adminId,mobile,username,unionId){
                $.ajax({
                    url:'/New/AdminAccount/adminAdd',
                    type:"POST",
                    dataType:"json",
                    // async: false,
                    data:{
                        adminId:adminId,
                        // mobile:mobile,
                        username:username,
                        unionId:unionId
                    },
                    success:function(data){
                        if(data.code == '200'){
                            $('.addlog').fadeOut('normal');
                            adminList(1)
                        }else{
                            // confirm("网络异常");
                        }           
                    }
                })
            }

            // 账号注销接口
            function del(adminId,obj){
               $.ajax({
                    url:'/New/AdminAccount/userCancel',
                    type:"POST",
                    dataType:"json",
                    data:{
                        adminId:adminId
                    },
                    success:function(data){
                        if(data.code == '200'){
                            obj.remove();
                            $('.numCgdialog .smcontent p').html('注销成功');
                            $('.numCgdialog').fadeIn('normal');
                            setTimeout(function(){$('.numCgdialog').fadeOut('normal');},800);
                        }else{
                            // confirm("网络异常");
                        }           
                    }
                })
            }

            $('input').on('focus',function(){
                $('.tipsMsg').html('');
            })

            $('#addAdmin').on('click',function(){
                $('.tipsMsg').html('');
                $('.addlog').fadeIn('normal');
                $('#userId').css('display','none');
                // $('.mobile').val('');
                $('.nickName').val('');
                $('.unionId').val(''); 
                $('#adminBtn').unbind('click').bind('click',function(){
                    // var mobile = $('.mobile').val();
                    var nickName = $('.nickName').val();
                    var unionId = $('.unionId').val(); 
                    if(nickName == ''){
                        $('.tipsMsg').html('请输入用户昵称');
                    }else if(unionId == ''){
                        $('.tipsMsg').html('请输入用户unionId');
                    }else if( nickName != ''&&unionId != ''){
                        console.log(1111);
                        adminEdit('',mobile,nickName,unionId);
                    }                  
                })
            })
            function loadFn(){
                $('.edit').on('click',function(){
                    $('.tipsMsg').html('');
                    $('.addlog').fadeIn('normal');
                    var userId = $(this).parent().parent().find('td').eq(0).html();
                    var nickName = $(this).parent().parent().find('td').eq(1).html();
                    // var mobile = $(this).parent().parent().find('td').eq(3).html();
                    var unionId = $(this).parent().parent().find('td').eq(2).html();
                    $('.userId').val(userId);
                    $('.nickName').val(nickName);
                    $('.mobile').val(mobile);
                    $('.unionId').val(unionId);
                    $('#userId').css('display','block');
                    $('#adminBtn').unbind('click').bind('click',function(){
                        userId = $('.userId').val();
                        // mobile = $('.mobile').val();
                        nickName = $('.nickName').val(); 
                        unionId = $('.unionId').val();
                        adminEdit(userId,mobile,nickName,unionId);              
                    })
                })
                // 注销
                $('.cancel').on('click',function(){
                    var r=confirm("确认对选中的账号注销吗？");
                    var adminId =$(this).parent().parent().find('td').eq(0).text();
                    var obj = $(this);
                    if(r==true){
                        del(adminId,obj);
                    }
                })
            }

            $('.lgdialogcloses').on('click',function(){
                $('.lgdialog').fadeOut('normal');
            })
                

            $('.mobile').on('blur',function(){
                var mobile = $('.mobile').val();
                checkMobile(mobile);
            })

            function checkMobile(str) {
                var re = /^1\d{10}$/
                if (!re.test(str)) {
                    $('.tipsMsg').html('请输入正确的手机号');
                }else{
                    $('.tipsMsg').html('');
                }
            }
            // checkMobile('139888888889');//错误示例
        </script>
        
   